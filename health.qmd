---
title: "kaush2"
editor: visual
---

Table 7

```{r}

library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)

file_path <- "datasets/healthcare_spendings.xlsx"

target_groups <- c("0-18","19-44","45-64","65-84","85+")
years <- c("2002","2004","2006","2008","2010","2012","2014","2016","2018","2020")

# ---------- READ TABLE 7 ----------
df7 <- read_excel(file_path, sheet = "Table 7", skip = 3)

# KEEP ONLY LEVELS (dollars) COLUMNS (first 11 columns only)
df7 <- df7[, 1:11]

names(df7)[1] <- "AgeGroup"

# FIX numeric columns (remove commas)
df7[2:11] <- lapply(df7[2:11], function(x) as.numeric(gsub(",", "", x)))

# ---------- EXTRACT MALE & FEMALE BLOCKS (exact positions) ----------
male_start7   <- which(df7$AgeGroup == "Males")    # row 13
female_start7 <- which(df7$AgeGroup == "Females")  # row 21

male_block7   <- df7[(male_start7+1):(male_start7+7), ]
female_block7 <- df7[(female_start7+1):(female_start7+7), ]

# Filter desired age groups ONLY
male_clean7 <- male_block7 |>
  filter(AgeGroup %in% target_groups)

female_clean7 <- female_block7 |>
  filter(AgeGroup %in% target_groups)

# Ensure same order
male_clean7$AgeGroup <- factor(male_clean7$AgeGroup, levels = target_groups)
female_clean7$AgeGroup <- factor(female_clean7$AgeGroup, levels = target_groups)

# ---------- PIVOT TO LONG ----------
male_long7 <- male_clean7 |>
  pivot_longer(all_of(years), names_to = "Year", values_to = "Male")

female_long7 <- female_clean7 |>
  pivot_longer(all_of(years), names_to = "Year", values_to = "Female")

df_long7 <- male_long7 |>
  left_join(female_long7, by = c("AgeGroup","Year")) |>
  mutate(
    Year = as.integer(Year),
    Gap = Female - Male
  )

# df7_long must contain: AgeGroup, Year, Male, Female, Gap
df7_gapplot <- df_long7 |>
  mutate(FemaleAdj = Female - Male) |>
  distinct(AgeGroup, Year, .keep_all = TRUE)

library(scales)

ggplot(df7_gapplot, aes(y = AgeGroup)) +
  geom_col(aes(x = FemaleAdj), fill = "#6baed6", alpha = 0.8) +
  geom_vline(xintercept = 0, color = "black", linewidth = 1) +
  facet_wrap(~Year, ncol = 5) +
  scale_x_continuous(labels = label_comma()) +
  labs(
    title = "Gender Difference in Total Per-Capita Health Care Spending",
    subtitle = "Female − Male spending. \nBars to the right of zero show where women spend more.",
    x = "Difference in Spending (USD)",
    y = ""
  ) +
  theme_minimal(base_size = 12) +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.line.x = element_line(color = "black", linewidth = 1),
    axis.ticks.x = element_line(color = "black"),
    strip.text = element_text(face = "bold"),
    legend.position = "none"
  )
 # theme(axis.text.x = element_text(angle = 90, hjust = 1))


```

out of pocket

```{r}
df_avg71 <- df_long71 |>
  group_by(AgeGroup) |>
  summarise(
    AvgMale = mean(Male, na.rm = TRUE),
    AvgFemale = mean(Female, na.rm = TRUE)
  )

ggplot(df_avg71, aes(y = AgeGroup)) +
  geom_segment(
    aes(x = AvgMale, xend = AvgFemale),
    color = "gray60", linewidth = 2
  ) +
  geom_point(aes(x = AvgMale), color = "#3182bd", size = 5) +
  geom_point(aes(x = AvgFemale), color = "#cb181d", size = 5) +
  scale_x_continuous(labels = label_comma()) +
  labs(
    title = "Women Consistently Pay More Out-of-Pocket at Every Age",
    subtitle = "Average per-capita out-of-pocket spending, 2002–2020",
    x = "Average Spending (USD)",
    y = ""
  ) +
  theme_minimal(base_size = 1) +
  theme(
    axis.line.x = element_line(color = "black"),
    axis.ticks.x = element_line(color = "black")
  )




```

Table 7 - total

```{r}
# ===============================
# 1. Compute GAP (Female - Male)
# ===============================

df_gap_7_1 <- df_long71 |>
  mutate(Gap = Female - Male)


# ===============================
# 2. Interactive Gender Gap Plot
# ===============================

p <- ggplot(df_gap_7_1, aes(x = Year, y = Gap, color = AgeGroup)) +
  geom_line(size = 1.3) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0, color = "black", linewidth = 1) +
  labs(
    title = "Out-of-Pocket Spending Gender Gap Over Time",
    subtitle = "Values represent Female − Male per-capita out-of-pocket spending",
    x = "Year",
    y = "Gap (USD)",
    color = "Age Group"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.minor = element_blank(),
    legend.position = "right"
  )

ggplotly(p)

```

In this graph, each colored line represents the difference between average female and male per-capita spending for a particular age group. Values above zero indicate years where women paid more than men, and the height of the line reflects the magnitude of the gap.

Women incur higher per-capita healthcare spending than men at nearly every age group, especially in midlife and older adulthood. This pattern is consistent over the 2002–2020 period in CMS national expenditure data.

Preggo

```{r}




library(readr)
library(dplyr)
library(ggplot2)

b1 <- read_csv("datasets/Natality_2003_2006.csv")
b2 <- read_csv("datasets/Natality_2007_2024.csv")

births_raw <- bind_rows(b1, b2)

#cleaning
births_clean <- births_raw |>
  select(Age = `Age of Mother 9`, Births) |>
  filter(!is.na(Age), Age != "Total") |>
  
  # CLEAN & SHORTEN AGE LABELS
  mutate(
    Age = trimws(Age),
    Age = recode(Age,
      "Under 15 years"      = "<15",
      "15-19 years"         = "15-19",
      "20-24 years"         = "20-24",
      "25-29 years"         = "25-29",
      "30-34 years"         = "30-34",
      "35-39 years"         = "35-39",
      "40-44 years"         = "40-44",
      "45-49 years"         = "45-49",
      "50 years and over"   = "50<"
    )
  ) |>
  group_by(Age) |>
  summarise(Births = sum(Births, na.rm = TRUE)) |>
  ungroup() |>
  mutate(
    Age = factor(
      Age,
      levels = c("< 15","15-19","20-24","25-29","30-34",
                 "35-39","40-44","45-49","50<")
    )
  )


ggplot(births_clean, aes(x = Age, y = Births)) +
  geom_col(fill = "darkgreen", alpha = 0.7) +
  scale_y_continuous(labels = function(x) paste0(x / 1e6, "M")) +
  labs(
    title = "U.S. Birth Counts by Maternal Age (2003–2024)",
    x = "Maternal Age Group",
    y = "Total Births"
  ) +
  theme_minimal(base_size = 16)


# line
ggplot(births_clean, aes(x = Age, y = Births, group = 1)) +
  geom_line(linewidth = 1.4, color = "red") +
  geom_point(size = 3) +
  scale_y_continuous(labels = function(x) paste0(x / 1e6, "M")) +
  labs(
    title = "Birth Distribution by Maternal Age",
    subtitle = "Births peak at ages 25–34",
    x = "Maternal Age Group",
    y = "Total Births (Millions)"
  ) +
  theme_minimal(base_size = 16)


```
